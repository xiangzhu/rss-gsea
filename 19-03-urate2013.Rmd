## GSEA Round 2 {#urate2013-2}

**Last updated:** `r Sys.Date()`

**Code version:** `r system("git log -1 --format='%H'", intern = TRUE)`

### Fit the null model

From the Round 1 null analysis (Section \@ref(urate2013-1)), I found that almost 100% posterior mass is concentrated on the setting `(h=0.5, theta0=-5.25)`. In Round 2, I used a finer grid. Specifically, I used the grids `theta0=(-5.5:0.025:-5)'` and `h=0.5` when fitting the null model. I estimated the (unnormalized) log importance weights ("pseudo-likelihoods") for all 21 sets of `(h,theta0)` under null.

```{r,echo=FALSE}
knitr::include_graphics("images/urate2013_null_round2.png", dpi=NA)
```

After normalizing the log "pseudo-likelihoods" (`logw.step*`) to posterior probabilities (`posp.step*`), we can see that almost 100% posterior mass is concentrated on the combinations of `h=0.5` and `theta0=(-5.4:0.025:-5)'`.
```{r, include=FALSE}
null.path <- "~/Dropbox/rss/Data/urate_2013/pathway/urate2013_null_201609.mat"
null.df <- null.mat2df(null.path)
```

```{r, echo=FALSE}
source("src/null_dt.R")
null.dt
```

```{r}
theta0.index <- as.character(null.df$theta0) %in% as.character(seq(-5.4,-5,by=0.025)) 
sum(null.df$posp.step1[theta0.index]) 
sum(null.df$posp.step2[theta0.index]) 
```

### Fit the enrichment model

To perform GSEA, I set `h=0.5` and `theta0=(-5.4:0.025:-5)'`, since the null analysis suggests that almost 100% posterior mass is placed on these settings. For the log-fold enrichment parameter, I use the grid `theta=(0:(4.7/180):4.7)'`, based on the Round 1 enrichment analysis (Section \@ref(urate2013-1)). The following table lists the GSEA results. 
```{r, include=FALSE}
gsea.path <- "~/Dropbox/rss/Data/urate_2013/pathway/urate2013_pathway_201609.mat"
gsea.df <- gsea.mat2df.round2(gsea.path) 
```

```{r, echo=FALSE}
source("src/gsea_dt_round2.R")
gsea.dt
```